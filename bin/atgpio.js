const bindingPath="./binding/"+process.platform+"-"+process.arch+"/node-atgpio.node",binding=require(bindingPath);let gpioInited=!1,gpioCount=0;function AtGpio(){gpioInited||AtGpio.prototype.init()}function checkPin(o){const t=Number(o);if(gpioInited||AtGpio.prototype.init(),t<0||t>=gpioCount)throw new Error("Invalid pin");return t}function checkValue(o){const t=Number(o);if(gpioInited||AtGpio.prototype.init(),t!==AtGpio.prototype.LOW&&AtGpio.prototype.HIGH!==t)throw new Error("Invalid value");return t}function checkMode(o){const t=Number(o);if(gpioInited||AtGpio.prototype.init(),t!==AtGpio.prototype.INPUT&&t!==AtGpio.prototype.OUTPUT)throw new Error(`Unsupported mode ${t}`);return t}function cleanup(){binding.Close(),gpioCount=0,gpioInited=!1}AtGpio.prototype.LOW=0,AtGpio.prototype.HIGH=1,AtGpio.prototype.INPUT=1,AtGpio.prototype.OUTPUT=0,AtGpio.prototype.init=(()=>{binding.Open(),gpioCount=binding.GetGPIOCount(),gpioInited=!0}),AtGpio.prototype.setup=((o,t,i)=>{gpioInited||AtGpio.prototype.init();const e=checkPin(o),p=checkMode(t);void 0!==i?binding.Setup(e,p,checkValue(i)):binding.Setup(e,p)}),AtGpio.prototype.read=(o=>binding.Read(checkPin(o))),AtGpio.prototype.write=((o,t)=>binding.Write(checkPin(o),checkValue(t))),AtGpio.prototype.getmode=(o=>{const t=checkPin(o);return binding.GetGPIODirection(t)}),AtGpio.prototype.count=(()=>(gpioInited||AtGpio.prototype.init(),gpioCount)),process.on("exit",o=>{console.log(`[ATGPIO] About to exit with code: ${o}`),cleanup()}),process.on("uncaughtException",o=>{console.error("UNCAUGHT EXCEPTION:",o),process.exit(1)}),module.exports=new AtGpio;
